<!DOCTYPE html>

<html lang="en">
    <head>
        <meta http-equiv="X-UA-Compatible" content="ie=edge">
        <title>Genshin Calculator</title>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width,initial-scale=1" />
        <meta name="description" content="" />
        
        <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
        
        <link href="https://cdn.jsdelivr.net/npm/modern-normalize@v2.0.0/modern-normalize.min.css" rel="stylesheet">
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">

        <script src="https://cdn.jsdelivr.net/npm/mathjs@13.0.3/lib/browser/math.min.js"></script>
        
        <script src="Wish_Calculator_JS.mjs" type="text/javascript"></script>
        <script src="http://parsleyjs.org/dist/parsley.js"></script>
    </head>
    <body>
        <style>
            body, html {
              margin-left:5%;
              margin-right:5%;
              margin-bottom:5%;
              margin-top:5%;
            }

            body { 
              background-color: #137b85; 
            }

            .header {
              padding: 60px;
              text-align: center;
              background: #a8b8d0;
              color: white;
              font-size: 50px;
            }

            #LoadingSpinner {
              width: 50px;
              height: 50px;
              border: 3px solid rgba(255,255,255,.3);
              border-radius: 50%;
              border-top-color: #fff;
              animation: spin 1s ease-in-out infinite;
              -webkit-animation: spin 1s ease-in-out infinite;
            }

            @keyframes spin {
              to { -webkit-transform: rotate(360deg); }
            }
            @-webkit-keyframes spin {
              to { -webkit-transform: rotate(360deg); }
            }

            ul.parsley-errors-list {
              list-style-type: none;
              padding: 0;
              margin: 0;
              color: #800000;
            }
        </style>
      
        <div class="header">Genshin Wish And Gacha Calculator</div><br>

        <form id="form" data-parsley-validate="true">
            <div class="container">
                <hr><center><h2>Calculator Settings</h2></center><br>
                
                <div class="accordion">
                    <div class="accordion-item">
                        <h2 class="accordion-header" id="ImportAccordion">
                            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#ImportAccordionContent" aria-expanded="false" aria-controls="ImportAccordionContent">
                                <h4 style="margin-left: 47%">Import</h4>
                            </button>
                        </h2>
                        <div id="ImportAccordionContent" class="accordion-collapse collapse" aria-labelledby="ImportAccordion" data-bs-parent="#ImportAccordion">
                            <div class="accordion-body">
                                <label for="ImportState" class="form-label">[PLACE HOLDER DESCRIPTION]</label><br>
                                <textarea id="ImportState" class="form-control"></textarea><br>
                                
                                <center><a id="Import" class="btn btn-primary" style="border-width: 1px; border-color: black;"> Import </a></center><br>
                            </div>
                        </div>
                    </div>

                    <div class="accordion-item">
                        <h2 class="accordion-header" id="ExportAccordion">
                            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#ExportAccordionContent" aria-expanded="false" aria-controls="ExportAccordionContent">
                                <h4 style="margin-left: 47.15%">Export</h4>
                            </button>
                        </h2>
                        <div id="ExportAccordionContent" class="accordion-collapse collapse" aria-labelledby="ExportAccordion" data-bs-parent="#ExportAccordion">
                            <div class="accordion-body">
                                <label for="ExportState" class="form-label">[PLACE HOLDER DESCRIPTION]</label><br>
                                <textarea id="ExportState" class="form-control" disabled></textarea><br>
                                


                            </div>
                        </div>
                    </div>
                </div>
 
                <hr><center><h2>Currency</h2></center><br>

                <div class="row">
                    <div class="col-sm">
                        <label for="Primos" class="form-label">Primogems</label><br>
                        <input type="number" id="Primos" class="form-control" data-parsley-trigger="change" data-parsley-required="true"><br>
                    </div>
                
                    <div class="col-sm">
                        <label for="Fates" class="form-label">Intertwined Fates</label><br>
                        <input type="number" id="Fates" class="form-control"><br>
                    </div>

                    <div class="col-sm">
                        <label for="Stardust" class="form-label">Masterless Stardust</label><br>
                        <input type="number" id="Stardust" class="form-control"><br>
                    </div>
                </div>
                <br>

                <center>
                    <input type="checkbox" id="UsingStarglitter" class="form-check-input">
                    <label for="UsingStarglitter" class="form-label">Using Masterless Starglitter</label><br>
                </center>

                <div class="row" id="StarglitterSkipGroup" style="display: none;">
                    <div class="col-sm">
                        <label for="Starglitter" class="form-label">Masterless Starglitter</label><br>
                        <input type="number" id="Starglitter" class="form-control"><br>
                    </div>
                
                    <div class="col-sm">
                        <label for="MissingFourStars" class="form-label">Missing Four Star Characters</label><br>
                        <input type="number" id="MissingFourStars" class="form-control"><br>
                    </div>

                    <div class="col-sm">
                        <label for="MissingFiveStars" class="form-label">Missing Standard Banner Five Star Characters</label><br>
                        <input type="number" id="MissingFiveStars" class="form-control"><br>
                    </div>
                </div>
                <br>

                <hr><center><h2>Wishing Goals</h2></center><br>

                <div class="row justify-content-md-center">
                    <div class="col-sm" style="margin-right: 12px;">
                        <label for="CharacterGoal" class="form-label">How many five star <strong>characters</strong> will you be wishing for? (Constellations included)</label>
                        <input type="number" id="CharacterGoal" data-parsley-max="50" max="50" data-parsley-trigger="change" class="form-control"><br>
                    </div>
                    <div class="col-sm">
                        <label for="WeaponGoal" class="form-label">How many five star <strong>weapons</strong> will you be wishing for? (Refinements included)</label>
                        <input type="number" id="WeaponGoal" data-parsley-max="50" max="50" data-parsley-trigger="change" class="form-control"><br>
                    </div>
                    <div class="col-sm" style="margin-right: 12px;">
                        <label for="EndPatch" class="form-label">What patch will you have made all your wishes by?</label>
                        <input type="number" id="EndPatch" data-parsley-trigger="change" class="form-control"><br>
                    </div>
                    <div class="col-sm">
                        <label for="EndPhase" class="form-label">What phase will you have made all your wishes by?</label>
                        <input type="number" id="EndPhase" data-parsley-min="1" data-parsley-max="2" min="1" max="2" data-parsley-trigger="change" class="form-control"><br>
                    </div>
                </div>
                <br>

                <hr><center><h2>Wishing History</h2></center><br>

                <div class="row justify-content-md-center">
                    <div class="col-sm-3" style="margin-right: 50px;">                        
                        <label for="CharacterPity" class="form-label">Character Pity</label>
                        <input type="number" id="CharacterPity" data-parsley-min="0" min="0" data-parsley-max="89" max="89" data-parsley-trigger="change" class="form-control">
                        <br><br>

                        <input type="checkbox" id="CharacterGuarantee" class="form-check-input">
                        <label for="CharacterGuarantee" class="form-label">Next Event Character Guaranteed</label><br>
                    </div>
                    <div class="col-sm-3">
                        <label for="WeaponPity" class="form-label">Weapon Pity</label>
                        <input type="number" id="WeaponPity" data-parsley-max="79" max="79" data-parsley-trigger="change" class="form-control">
                        <br><br>

                        <input type="checkbox" id="WeaponGuarantee" class="form-check-input">
                        <label for="WeaponGuarantee" class="form-label">Next Event Weapon Guaranteed</label>
                        <br><br>

                        <label for="EndPhase" class="form-label">Weapon Banner Fate Points</label>
                        <input type="number" id="EndPhase" data-parsley-min="1" data-parsley-max="2" min="1" max="2" data-parsley-trigger="change" class="form-control"><br>
                    </div>
                </div>
                <br>

                <hr><center><h2>Spiral Abyss</h2></center><br>
                <center><h3>Expectected Stars:</h3></center>

                <div class="row">
                    <div class="col-sm">
                        <label for="F9" class="form-label">Floor 9</label><br>
                        <input type="number" id="F9" data-parsley-max="9" max="9" data-parsley-trigger="change" class="form-control">
                    </div>
                
                    <div class="col-sm">
                        <label for="F10" class="form-label">Floor 10</label><br>
                        <input type="number" id="F10" class="form-control">
                    </div>

                    <div class="col-sm">
                        <label for="F11" class="form-label">Floor 11</label><br>
                        <input type="number" id="F11" class="form-control">
                    </div>

                    <div class="col-sm">
                        <label for="F12" class="form-label">Floor 12</label><br>
                        <input type="number" id="F12" class="form-control">
                    </div>
                </div>
                <br>

                <center>
                    <input type="checkbox" id="AbyssCurrentCycleCompleted" class="form-check-input">
                    <label for="AbyssCurrentCycleCompleted" class="form-label">Current cycle completed?</label><br>
                </center>

                <hr><center><h2>Imaginarium Theater</h2></center><br>

                <div class="row">
                    <center>
                        <div class="col-sm-2">
                            <label for="ExpectectedAct" class="form-label">Expectected Act</label>
                            <input type="number" id="ExpectectedAct" data-parsley-max="8" max="8" data-parsley-trigger="change" class="form-control"><br>
                        </div>
                        <div class="col-sm-3">
                            <input type="checkbox" id="TheaterCurrentCycleCompleted" class="form-check-input">
                            <label for="TheaterCurrentCycleCompleted" class="form-label">Current cycle completed</label><br>
                        </div>
                    </center>
                </div>
                <br>


                <hr>
                <center><h2>Battle Pass & Welkin</h2></center><br>
                <div class="row">
                    <center>
                        <div class="col-sm">
                            <input type="checkbox" id="HasWelkin" class="form-check-input">
                            <label for="HasWelkin" class="form-label">Purchasing Blessing of the Welking Moon</label>
                        </div>
                        <div class="col-sm-3">
                            <input type="checkbox" id="BPPurchased" class="form-check-input">
                            <label for="BPPurchased" class="form-label">Purchasing Battle Pass</label>
                        </div>
                    </center>
                </div>

                <div class="row">
                    <center>
                        <div class="col-sm-2" id="BPLevelSkipGroup" style="display: none;">
                            <label for="BPLevel" class="form-label">Battle Pass Level</label>
                            <input type="number" id="BPLevel" data-parsley-max="50" max="50" data-parsley-trigger="change" class="form-control">
                        </div>
                    </center>
                </div>
                <hr>





                <center><a id="Calculate" class="btn btn-primary" style="border-width: 1px; border-color: black;"> Calculate </a></center><br>
            </div>
        </form>

        <div>
            <center>
                <div id="LoadingGroup" style="display: none;">
                    <div id="LoadingSpinner"></div>
                    <span id="LoadingText"></span>
                </div>

                <!-- TODO: Maybe change the message a bit. -->
                <div id="ValidationWarning" style="display: none; color: #800000;">Please correct any invalid data.</div>
                
                <div id="WishEndDate" style="display: none;"></div>

                <div id="BannerEnded" style="display: none;"></div>

                <div id="MaxWishes" style="display: none;"></div>

                <div id="WishingGoals" style="display: none;"></div>

                <div id="Chance" style="display: none;"></div>
            </center>
        </div>

      <!-- <div class="accordion" id="accordionExample">
        <div class="accordion-item">
          <h2 class="accordion-header" id="headingOne">
            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseOne" aria-expanded="false" aria-controls="collapseOne">
              Accordion Section Heading 1
            </button>
          </h2>
          <div id="collapseOne" class="accordion-collapse collapse" aria-labelledby="headingOne" data-bs-parent="#accordionExample">
            <div class="accordion-body">
              Accordion Section Content 1
            </div>
          </div>
        </div>
        <div class="accordion-item">
          <h2 class="accordion-header" id="headingTwo">
            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseTwo" aria-expanded="false" aria-controls="collapseTwo">
              Accordion Section Heading 2
            </button>
          </h2>
          <div id="collapseTwo" class="accordion-collapse collapse" aria-labelledby="headingTwo" data-bs-parent="#accordionExample">
            <div class="accordion-body">
              Accordion Section Content 2
            </div>
          </div>
        </div>
        <div class="accordion-item">
          <h2 class="accordion-header" id="headingThree">
            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseThree" aria-expanded="false" aria-controls="collapseThree">
              Accordion Section Heading 3
            </button>
          </h2>
          <div id="collapseThree" class="accordion-collapse collapse" aria-labelledby="headingThree" data-bs-parent="#accordionExample">
            <div class="accordion-body">
              Accordion Section Content 3
            </div>
          </div>
        </div>
      </div>
      <table class="table">
        <tr>
          <td>Row 1, Column 1</td>
          <td>Row 1, Column 2</td>
          <td>Row 1, Column 3</td>
        </tr>
        <tr>
          <td>Row 2, Column 1</td>
          <td>Row 2, Column 2</td>
          <td>Row 2, Column 3</td>
        </tr>
      </table> -->

        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" crossorigin="anonymous"></script>
        <script type="text/javascript">
            
            $('input[type=number]').attr('data-parsley-min', 0);

            var ResultsLoaded = false;
            // TODO: Disable the button when clicked and reenable once its done processing.
            $("#Calculate").on('click', function() {
                $('#ValidationWarning').hide();
                
                $('input').change();
                
                if ($('.parsley-error').length != 0) {
                    $('#ValidationWarning').show();
                }
                else {
                    if (ResultsLoaded) {
                        $('#LoadingText').html('Recalculating...');
                    }
                    else{
                        $('#LoadingText').html('Loading...');
                    }

                    $('#LoadingGroup').show();

                    $(document).ready(function() {
                        var WishConfig2 = {
                          CurrentPrimos: $('#Primos').val(),
                          CurrentIntertwinedFates: $('#Fates').val(),
                        }

                        WishCalcs(WishConfig.Matthew, WishConfig2);

                    ResultsLoaded = true

                    $('#LoadingGroup').hide();
                  })
                }
            })

            // Skip Logic
            $('#UsingStarglitter').on('change', function(){
                if ($('#UsingStarglitter').is(':checked')) {
                    $('#StarglitterSkipGroup').show();
                }
                else {
                    $('#StarglitterSkipGroup').hide();
                }
            });

            $('#BPPurchased').on('change', function(){
                if ($('#BPPurchased').is(':checked')) {
                    $('#BPLevelSkipGroup').show();
                }
                else {
                    $('#BPLevelSkipGroup').hide();
                }
            });

            function UpdateExportState(){
                var FormValues = {};
                
                $('#form input').each(function() {
                    if ($(this).is(':checkbox')) {
                        FormValues[this.id] = $(this).is(':checked')
                    }
                    else {
                        FormValues[this.id] = this.value;
                    }
                });
                
                $('#ExportState').val(JSON.stringify(FormValues))
            };

            $(document).ready(UpdateExportState);
            $('#form').on('change', UpdateExportState);

            $('#Import').on('click', function() {
                var JSONImport = JSON.parse($('#ImportState').val());
                
                $('#form input').each(function() {
                    if ($(this).is(':checkbox')) {
                        $(this).prop('checked', JSONImport[this.id]);
                    }
                    else {
                        $(this).val(JSONImport[this.id]);
                    }
                })
            });
        </script>
    </body>
</html>